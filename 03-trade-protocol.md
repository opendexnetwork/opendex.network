# BOLD #3: Trade Protocol

## Overview

Order matching systems of major exchanges differentiate between two participants: the taker and the maker. A taker "fills" the order of a maker. 

Similarly, we distinguish between these two types of participants in a trade on OpenDEX:

* The **Maker**: submits an order which cannot be matched immediately by an existing order in the order book. The order is added to the order book and may broadcasted to higher delay matcher. 
* The **Taker**: issues an order which can immediately be matched with an existing (maker) order in the order book.

## Order Type

	`string id = 1`
	The order's globally unique identifier, generated by the sender 

    `string pair_id = 1`
    A trading pair symbol, constructed with the base currency first, followed by a '/' separator and the quote currency, followed by '/' separator and orderbook delay (e.g., “LTC/BTC/2”)

    `double price = 3`
    The price for the order expressed in units of the quote currency

    `uint64 quantity = 4`
    The number of satoshis (or equivalent) for the order

    `bool is_buy = 5`
    Whether the order is a buy (true) or a sell (false)
    
    `string order_type = 6`
    Type is market, limit or post_only
    
    `string trigger_price = 7`
     Order won't be placed to orderbook before trigger price is reached. If order doesn't have trigger price, this can be empty. After trigger price there is separator '/' and 'over' or 'under'.
    
	
### Order Types
Market order:
Market order will be matched immediatly.

Limit order: 
Limit orders are used to specify a maximum or minimum price the trader is willing to buy or sell at.

Post only order:
Order will be placed to orderbook only if it won't be matched immediatly. If order could be matched immediatly, it not either will be matched. 


## Trade Protocol
### Order Message (0x06)

    `string id = 1`
	The message's globally unique identifier, generated by the sender 

	`Order order = 2`
	The order

    `orderbook id = 3`
    Orderbook where you want to place order

The `Order` message is used to tell a matcher about a new order. It should only be sent to matcher after the order (or part of the order) could not be matched in the local order book.

### OrderInvalidation Message (0x07)

	`string id = 1`
	The message's globally unique identifier, generated by the sender 

    `string order_id = 2`
    The order’s unique identifier

    `string pair_id = 3`
    The trading pair symbol associated with the order

    `uint64 quantity = 4`
    The number of satoshis (or equivalent) to invalidate from the order sum

The `OrderInvalidation` message is used to tell a matcher about the full or partial invalidation of a previously sent order. It allows the matcher to remove the order from orderbook. Order invalidation is a common event which occurs due to order cancellation or filling (by another order). Failing to send updates about the order will result in peers having a stale order in their orderbooks. These matcher might fill the order and instantiate swap procedures which are doomed to fail. In this case, the maker node’s reputation may be penalized. 

### The GetOrders Message (0x08)

	`string id = 1`
	The message's globally unique identifier, generated by the sender 

    `repeated string pair_ids = 2`
    The requested orders trading pair symbols, constructed with the base currency first, followed by a  '/' separator and the quote currency (e.g., [“LTC/BTC”, “DAI/BTC”])

The `GetOrders` message is used to query a peer for a list of all open orders for the specified trading pairs. It is mainly used to initialize the local order book with a snapshot of the peer's existing open orders after establishing a connection to the peer. New orders are expected to get pushed by the peer via the `Order` message, instead of being queried for. 

### The Orders Message (0x09)

	`string id = 1`
	The message's globally unique identifier, generated by the sender 

    `string req_id = 2`
    The id from the received `GetOrders` message

    `repeated Order orders = 3`
    The list of orders

The `Orders` message is used to respond to the `GetOrders` message.
